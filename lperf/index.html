<!DOCTYPE html>
<style>
.axis { font: 30px sans-serif; }
</style>
<script src="https://d3js.org/d3.v4.min.js"></script>
<script>

var data = [];
var max = 0;

d3.text("try", function(text) {
		var tt = 0;
		d3.csvParseRows(text, function(d) {
				//if (max < d[1]) {
				//	max = d[1]
				//}
				var cum = 0;
				for (i=2,t=0;i<d.length;i+=5,t++) {
				var dd = new Object();
				dd.id=d[0];
				dd.total=d[1];
				dd.value = d[i+3] - d[i+2];
				dd.ttype = d[i];
				dd.stype = d[i+1];
				dd.waitfor = d[i+4];
				dd.cum = cum;
				dd.y = tt+1;
				cum += dd.value;
				data.push(dd);
				}
				if (max < cum) {
					max = cum;
				}
				tt += 1;
		});


		var margin = {top: 10, right: 20, bottom: 10, left: 20},
				svgWidth = 1280
				svgHeight = 400

		var xScale = d3.scaleLinear()
			.range([margin.left, svgWidth-margin.right]).domain([0,max]);

		console.log(max);
		max = 1280 / max;

		var svg = d3.select("body").append("svg")
			.attr("width", svgWidth + margin.left + margin.right)
			.attr("height", svgHeight+ margin.top + margin.bottom);

		var xAxis = d3.axisBottom()
			.scale(xScale);

		var bar = svg.selectAll("g")
			.data(data)
			.enter().append("g")

		bar.append("rect")
			.style("stroke", "black")
			.style("fill", function(d) {if (d.ttype == 1) return "red"; else if (d.ttype == 2) return "orange"; else if (d.ttype == 3) return "lightblue"; else return "none"})
			.attr("x", function(d) {return d.cum*max + margin.left;})
			.attr("y", function(d) {return d.y*25;})
			.attr("width", function(d) { return d.value*max; })
			.attr("height", 20);

		bar.append("text")
			.attr("x", function(d) {return d.cum*max + margin.left + 1;})
			.attr("y", function(d) {return d.y*25+10;})
			.attr("dy", ".35em")
			.text(function(d) {if (d.stype == 0) return "R"; else if (d.stype == 1) return "-"; else if (d.stype == -1) return "G"; else return "W" + d.waitfor })

		svg.append("g")
		  .attr("transform", "translate(0, 390)")
			.call(xAxis); 

});
</script>
